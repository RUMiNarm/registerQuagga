<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>QuaggaJS Example</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/@ericblade/quagga2@1.7.4/dist/quagga.min.js"></script>
    <script src="script.js"></script>
  </head>
  <body>
    <div class="main-container">
      <section>
        <div class="wrapper">
          <div id="container"><!-- ここにカメラ映像を挿入 --></div>
        </div>
        <script>
          // Quaggaの初期化
          window.onload = function () {
            Quagga.init(
              {
                inputStream: {
                  type: 'LiveStream',
                  target: document.querySelector('#container')
                },
                constraints: { facingMode: 'environment' },
                decoder: { readers: ['ean_reader'] }
              },
              function (err) {
                if (err) {
                  console.log(err);
                  return;
                }
                Quagga.start();
              }
            );
            // バーコードに青枠をつける
            Quagga.onProcessed((result) => {
              let ctx = Quagga.canvas.ctx.overlay;
              let canvas = Quagga.canvas.dom.overlay;
              canvas.classList.add('drawingBuffer'); // 描画用のクラスを追加
              ctx.clearRect(0, 0, parseInt(canvas.width), parseInt(canvas.height));
              if (result) {
                if (result.box) {
                  Quagga.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, ctx, { color: 'blue', lineWidth: 2 });
                }
              }
            });
          };
        </script>
      </section>
      <section>
        <div class="receipt">
          <div class="receipt-items" id="ReceiptItems"></div>
          <div class="total">
            <span>合計</span>
            <span class="total-price" id="TotalPrice">0</span>
          </div>
        </div>
      </section>
    </div>
  </body>
</html>
